<?xml version="1.0" encoding="UTF-8"?>
<project name="AntProject" default="Build" basedir=".">
<taskdef resource="net/sf/antcontrib/antlib.xml" />      
    <property file="build_all.properties"/>
    <property name="srcDir" location="${proj.dir}/src" />
    <property name="workDir" location="${work.dir}" />
    <path id="project.lib">
        <fileset dir="${javac.lib1}">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="${javac.lib2}">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="/usr/java/jdk1.8.0_131/lib">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="/usr/java/jdk1.8.0_131/jre">
            <include name="**/*.jar"/>
        </fileset>
    </path>
    <target name="Init">
       <delete dir="${proj.dir}/web/WEB-INF/classes" />
       <delete dir="${work.dir}/life" />
       <mkdir dir="${proj.dir}/web/WEB-INF/classes" />
       <mkdir dir="${work.dir}/life" />
    </target>
    <target name="Compile" depends="Init">
        <javac srcdir="${srcDir}" destdir="${proj.dir}/web/WEB-INF/classes"  encoding="GBK" includeantruntime="false">
           <classpath refid="project.lib"/>
        </javac>
    </target>
    <target name="Copy" depends="Compile">
       <copy todir="${work.dir}/life">
            <fileset dir="${proj.dir}">
          </fileset>
       </copy>
    </target>
    <target name="Copy_baseconfig" depends="Copy">
            <foreach list="${baseconfig.file}" target="screen_number" param="number" delimiter=",">
                
            </foreach>
    </target>
    
    <target name="screen_number">
         <propertyregex property="result" input="${number}" regexp="/tpsys/workspace/baseconfig_file/life/" replace="" />
             <echo message="${result}"></echo>
          <copy todir="${work.dir}/${proj.name}/${result}"  file="${number}"/>
 
   </target>
    <target name="Build" depends="Init,Compile,Copy,Copy_baseconfig">
         <if>  
        <equals arg1="${build.type}" arg2="tar"/>  
        <then>  
            <tar destfile="${work.dir}/${proj.name}_${branch}.tgz" compression="gzip">
                <tarfileset dir="${work.dir}/${proj.name}" prefix="">
                        <include name="web/intserv/**"/>
                        <include name="web/WEB-INF/lib/*.jar"/>
                        <include name="web/WEB-INF/classes/com/cntaiping/intserv/basic/runtime/file/remote/*.class"/>
                                <exclude name="web/WEB-INF/classes/com/cntaiping/intserv/basic/runtime/file/remote/FileUtilInterface.class"/>
                        <include name="web/WEB-INF/urlrewrite.xml"/>
             </tarfileset>
        </tar>
  
        </then>  
    <elseif>  
        <equals arg1="${build.type}" arg2="jar"/>  
        <then>  
            <jar destfile="${work.dir}/${proj.name}_${branch}.jar" >
              <fileset dir="${work.dir}/${proj.name}">

                        <include name="web/intserv/**"/>
                        <include name="web/WEB-INF/lib/*.jar"/>
                        <include name="web/WEB-INF/classes/com/cntaiping/intserv/basic/runtime/file/remote/*.class"/>
                                <exclude name="web/WEB-INF/classes/com/cntaiping/intserv/basic/runtime/file/remote/FileUtilInterface.class"/>
                        <include name="web/WEB-INF/urlrewrite.xml"/>
                </fileset>
              </jar>
    
        </then>  
    </elseif> 
    <elseif>
       <!-- 建立新war包。 -->
       <equals arg1="${build.type}" arg2="war"/> 
       <then>  
             <war destfile="${work.dir}/${proj.name}_${branch}.war" webxml="${work.dir}/${proj.name}/web/web.xml">
                <fileset dir="${work.dir}/${proj.name}">
                       <include name="web/intserv/**"/>
                        <include name="web/WEB-INF/lib/*.jar"/>
                        <include name="web/WEB-INF/classes/com/cntaiping/intserv/basic/runtime/file/remote/*.class"/>
                                <exclude name="web/WEB-INF/classes/com/cntaiping/intserv/basic/runtime/file/remote/FileUtilInterface.class"/>
                        <include name="web/WEB-INF/urlrewrite.xml"/>
             </fileset>
        </war>
        </then>   
    </elseif> 
    </if>  
    </target>


</project>

-------------------------------------------------------------------------------------------------------------------------------

<?xml version="1.0"?>
<project name="AntProject" default="tar" basedir=".">
    <property file="build_diff.properties"/>
    <property name="srcDir" location="${proj.dir}/src" />
    <property name="workDir" location="${work.dir}" />
    <property name="branch1" value="${branch1}" />
    <property name="branch2" value="${branch2}" />
    <path id="project.lib">
        <fileset dir="${javac.lib1}">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="${javac.lib2}">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="/usr/java/jdk1.8.0_131/lib">
            <include name="**/*.jar"/>
        </fileset>
        <fileset dir="/usr/java/jdk1.8.0_131/jre">
            <include name="**/*.jar"/>
        </fileset>
    </path>

   <target name="Init">
       <delete dir="${proj.dir}/web/WEB-INF/classes" />
       <delete dir="${work.dir}/life" />
       <mkdir dir="${proj.dir}/web/WEB-INF/classes" />
       <mkdir dir="${work.dir}/life" />
    </target>
    <target name="Compile" depends="Init">
        <javac srcdir="${srcDir}" destdir="${proj.dir}/web/WEB-INF/classes"  encoding="GBK" includeantruntime="false">
           <classpath refid="project.lib"/>
        </javac>
    </target>
    <target name="Copy" depends="Compile">
       <copy todir="${work.dir}/life">
            <fileset dir="${proj.dir}">
          </fileset>
       </copy>
    </target>

   <target name="Build"  depends="Copy">
                <exec executable="git" dir="/tpsys/jenkins/workspace/test_zeng" output="/tpsys/workspace/compile/base_life/diff.txt">
                      <arg line="diff remotes/origin/${branch1} remotes/origin/${branch2} --name-status" />
                </exec>
                      <replaceregexp match="(M|A)\t" replace="" byline="true" file="${work.dir}/diff.txt"/>
                     
                      <replaceregexp match="src/" replace="web/WEB-INF/classes/" byline="true" file="${work.dir}/diff.txt"/>
                      
                      <replaceregexp match="\.java" replace="\.class" flags="m" byline="true" file="${work.dir}/diff.txt"/>
                           

        </target>

    <target name="tar"  depends="Build">
        
    <delete file="${work.dir}/diff_${branch1}.tgz"/>
                <tar destfile="${work.dir}/diff_${branch1}.tgz" compression="gzip">        
                <tarfileset dir="${proj.dir}" prefix="">
                        <includesfile name="/tpsys/workspace/compile/base_life/diff.txt"/>
                </tarfileset>
                </tar>
    </target>

    
 
</project>
